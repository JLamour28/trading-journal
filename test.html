<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trading Journal - Test</title>
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/forms.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .test-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background: var(--surface);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
      }
      .test-section {
        margin-bottom: 2rem;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
      }
      .test-button {
        margin: 0.5rem;
      }
      .test-result {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: var(--radius-sm);
        font-family: monospace;
        font-size: 0.9rem;
      }
      .test-result.success {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid var(--success-color);
        color: var(--success-color);
      }
      .test-result.error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid var(--danger-color);
        color: var(--danger-color);
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1><i class="fas fa-vial"></i> Trading Journal - Test Suite</h1>
      <p>
        Run these tests to verify your Trading Journal is working correctly.
      </p>

      <!-- Data Manager Tests -->
      <div class="test-section">
        <h2><i class="fas fa-database"></i> Data Manager Tests</h2>
        <button class="btn btn-primary test-button" onclick="testDataManager()">
          <i class="fas fa-play"></i> Test Data Manager
        </button>
        <div
          id="dataManagerResult"
          class="test-result"
          style="display: none"
        ></div>
      </div>

      <!-- Calculator Tests -->
      <div class="test-section">
        <h2><i class="fas fa-calculator"></i> Calculator Tests</h2>
        <button class="btn btn-primary test-button" onclick="testCalculator()">
          <i class="fas fa-play"></i> Test Calculator
        </button>
        <div
          id="calculatorResult"
          class="test-result"
          style="display: none"
        ></div>
      </div>

      <!-- Chart Tests -->
      <div class="test-section">
        <h2><i class="fas fa-chart-line"></i> Chart Tests</h2>
        <button class="btn btn-primary test-button" onclick="testCharts()">
          <i class="fas fa-play"></i> Test Charts
        </button>
        <div id="chartsResult" class="test-result" style="display: none"></div>
      </div>

      <!-- Sample Data Tests -->
      <div class="test-section">
        <h2><i class="fas fa-plus-circle"></i> Sample Data Tests</h2>
        <button class="btn btn-primary test-button" onclick="addSampleData()">
          <i class="fas fa-plus"></i> Add Sample Data
        </button>
        <button
          class="btn btn-secondary test-button"
          onclick="clearSampleData()"
        >
          <i class="fas fa-trash"></i> Clear Sample Data
        </button>
        <div
          id="sampleDataResult"
          class="test-result"
          style="display: none"
        ></div>
      </div>

      <!-- Navigation Tests -->
      <div class="test-section">
        <h2><i class="fas fa-compass"></i> Navigation Tests</h2>
        <a href="index.html" class="btn btn-primary test-button">
          <i class="fas fa-tachometer-alt"></i> Go to Dashboard
        </a>
        <a href="pages/add-trade.html" class="btn btn-secondary test-button">
          <i class="fas fa-plus-circle"></i> Go to Add Trade
        </a>
        <a href="pages/trade-list.html" class="btn btn-secondary test-button">
          <i class="fas fa-list"></i> Go to Trade List
        </a>
        <a href="pages/settings.html" class="btn btn-secondary test-button">
          <i class="fas fa-cog"></i> Go to Settings
        </a>
      </div>

      <!-- Browser Info -->
      <div class="test-section">
        <h2><i class="fas fa-info-circle"></i> Browser Information</h2>
        <div id="browserInfo"></div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/data-manager.js"></script>
    <script src="js/calculations.js"></script>
    <script src="js/charts.js"></script>
    <script>
      function showResult(elementId, message, isSuccess) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = message;
          element.className = `test-result ${isSuccess ? "success" : "error"}`;
          element.style.display = "block";
        }
      }

      function testDataManager() {
        try {
          // Test basic operations
          const testTrade = {
            assetType: "stocks",
            symbol: "TEST",
            direction: "long",
            status: "closed",
            positionSize: 100,
            entryPrice: 100,
            entryDate: new Date().toISOString(),
            exitPrice: 105,
            exitDate: new Date().toISOString(),
            commission: 5,
            stopLoss: 95,
            takeProfit: 110,
            accountSize: 10000,
          };

          // Test add trade
          const addedTrade = tradeManager.addTrade(testTrade);

          // Test get trade
          const retrievedTrade = tradeManager.getTrade(addedTrade.id);

          // Test update trade
          tradeManager.updateTrade(addedTrade.id, { rating: 5 });

          // Test get all trades
          const allTrades = tradeManager.getAllTrades();

          // Test delete trade
          tradeManager.deleteTrade(addedTrade.id);

          const finalTrades = tradeManager.getAllTrades();

          const success =
            addedTrade.id &&
            retrievedTrade.id === addedTrade.id &&
            allTrades.length > 0 &&
            finalTrades.length === 0;

          showResult(
            "dataManagerResult",
            `Data Manager Test: ${success ? "PASSED" : "FAILED"}\n` +
              `Added trade ID: ${addedTrade.id}\n` +
              `Retrieved trade ID: ${retrievedTrade.id}\n` +
              `All trades count: ${allTrades.length}\n` +
              `Final trades count: ${finalTrades.length}`,
            success
          );
        } catch (error) {
          showResult(
            "dataManagerResult",
            `Data Manager Test: FAILED\nError: ${error.message}`,
            false
          );
        }
      }

      function testCalculator() {
        try {
          const testTrades = [
            { profitLoss: 100, riskRewardRatio: 2 },
            { profitLoss: -50, riskRewardRatio: 1.5 },
            { profitLoss: 200, riskRewardRatio: 3 },
          ];

          const winRate = tradeCalculator.calculateWinRate(testTrades);
          const profitFactor =
            tradeCalculator.calculateProfitFactor(testTrades);
          const avgWin = tradeCalculator.calculateAverageWin(testTrades);
          const avgLoss = tradeCalculator.calculateAverageLoss(testTrades);

          const success =
            winRate >= 0 && profitFactor >= 0 && avgWin >= 0 && avgLoss <= 0;

          showResult(
            "calculatorResult",
            `Calculator Test: ${success ? "PASSED" : "FAILED"}\n` +
              `Win Rate: ${winRate.toFixed(2)}%\n` +
              `Profit Factor: ${profitFactor.toFixed(2)}\n` +
              `Average Win: $${avgWin.toFixed(2)}\n` +
              `Average Loss: $${avgLoss.toFixed(2)}`,
            success
          );
        } catch (error) {
          showResult(
            "calculatorResult",
            `Calculator Test: FAILED\nError: ${error.message}`,
            false
          );
        }
      }

      function testCharts() {
        try {
          // Test chart creation
          const testCanvas = document.createElement("canvas");
          testCanvas.id = "testChart";
          testCanvas.width = 400;
          testCanvas.height = 200;

          document.body.appendChild(testCanvas);

          const testTrades = [
            { profitLoss: 100, exitDate: "2024-01-01" },
            { profitLoss: -50, exitDate: "2024-01-02" },
            { profitLoss: 200, exitDate: "2024-01-03" },
          ];

          const chart = chartRenderer.createEquityCurve(
            "testChart",
            testTrades
          );

          const success = chart && chart.data && chart.data.datasets;

          // Clean up
          document.body.removeChild(testCanvas);

          showResult(
            "chartsResult",
            `Charts Test: ${success ? "PASSED" : "FAILED"}\n` +
              `Chart created: ${success ? "YES" : "NO"}\n` +
              `Datasets: ${success ? chart.data.datasets.length : 0}`,
            success
          );
        } catch (error) {
          showResult(
            "chartsResult",
            `Charts Test: FAILED\nError: ${error.message}`,
            false
          );
        }
      }

      function addSampleData() {
        try {
          const sampleTrades = [
            {
              assetType: "stocks",
              symbol: "AAPL",
              direction: "long",
              status: "closed",
              positionSize: 100,
              entryPrice: 150.25,
              entryDate: "2024-01-15T09:30:00Z",
              exitPrice: 155.5,
              exitDate: "2024-01-16T14:25:00Z",
              commission: 5.0,
              stopLoss: 148.0,
              takeProfit: 155.0,
              accountSize: 10000,
              strategy: "Momentum Breakout",
              rationale: "Strong volume breakout above resistance",
              emotionalState: "calm",
              marketConditions: "trending",
              rating: 4,
            },
            {
              assetType: "crypto",
              symbol: "BTC/USD",
              direction: "long",
              status: "closed",
              positionSize: 0.5,
              entryPrice: 42150,
              entryDate: "2024-01-14T10:15:00Z",
              exitPrice: 42800,
              exitDate: "2024-01-15T16:30:00Z",
              commission: 25.0,
              stopLoss: 41000,
              takeProfit: 43000,
              accountSize: 10000,
              strategy: "Trend Following",
              rationale: "Breakout above key resistance",
              emotionalState: "calm",
              marketConditions: "trending",
              rating: 5,
            },
          ];

          let addedCount = 0;
          sampleTrades.forEach((trade) => {
            try {
              tradeManager.addTrade(trade);
              addedCount++;
            } catch (error) {
              console.error("Error adding sample trade:", error);
            }
          });

          showResult(
            "sampleDataResult",
            `Sample Data: Added ${addedCount} of ${sampleTrades.length} trades successfully`,
            addedCount === sampleTrades.length
          );
        } catch (error) {
          showResult(
            "sampleDataResult",
            `Sample Data: FAILED\nError: ${error.message}`,
            false
          );
        }
      }

      function clearSampleData() {
        try {
          tradeManager.saveTrades([]);
          showResult(
            "sampleDataResult",
            "All sample data cleared successfully",
            true
          );
        } catch (error) {
          showResult(
            "sampleDataResult",
            `Clear Data: FAILED\nError: ${error.message}`,
            false
          );
        }
      }

      function showBrowserInfo() {
        const info = `
                <strong>Browser:</strong> ${navigator.userAgent}<br>
                <strong>Platform:</strong> ${navigator.platform}<br>
                <strong>Language:</strong> ${navigator.language}<br>
                <strong>LocalStorage Available:</strong> ${
                  typeof Storage !== "undefined" ? "YES" : "NO"
                }<br>
                <strong>Cookies Enabled:</strong> ${
                  navigator.cookieEnabled ? "YES" : "NO"
                }<br>
                <strong>Screen Resolution:</strong> ${screen.width}x${
          screen.height
        }<br>
                <strong>Color Depth:</strong> ${screen.colorDepth} bits
            `;

        document.getElementById("browserInfo").innerHTML = info;
      }

      // Initialize browser info on load
      document.addEventListener("DOMContentLoaded", showBrowserInfo);
    </script>
  </body>
</html>
